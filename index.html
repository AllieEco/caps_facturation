<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau de Bord Comptable - CAPSLOCK</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><style>.cls-1{fill:%23f4d03f;}.cls-2{fill:%23333;stroke:%23333;stroke-width:2;fill:none;}.cls-3{fill:%23333;}</style></defs><polygon class='cls-1' points='45,10 50,20 60,20 52,28 55,38 45,33 35,38 38,28 30,20 40,20'/><polygon class='cls-1' points='70,25 73,30 78,30 75,33 76,38 70,35 64,38 65,33 62,30 67,30'/><polygon class='cls-1' points='58,45 61,50 66,50 63,53 64,58 58,55 52,58 53,53 50,50 55,50'/><rect class='cls-2' x='15' y='25' width='45' height='60' rx='3'/><rect class='cls-3' x='20' y='35' width='25' height='2'/><rect class='cls-3' x='20' y='45' width='20' height='2'/><rect class='cls-3' x='20' y='55' width='25' height='2'/><rect class='cls-3' x='20' y='65' width='15' height='2'/><circle class='cls-2' cx='70' cy='60' r='15'/><text x='70' y='67' text-anchor='middle' class='cls-3' font-family='Arial' font-size='16' font-weight='bold'>$</text><path class='cls-2' d='M15,80 Q15,85 20,85 L75,85 Q80,85 80,80 L80,75 L15,75 Z'/></svg>" type="image/svg+xml">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="assets/css/footer-styles.css">
  <link rel="stylesheet" href="assets/css/header-styles.css">
  <style>
    /* Variables CSS pour la coh√©rence des couleurs */
    :root {
      --primary-color: #1a7ee7;
      --primary-dark: #0f5bb8;
      --primary-light: #4a90e2;
      --success-color: #27ae60;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --purple-color: #8e44ad;
      --text-dark: #2c3e50;
      --text-light: #7f8c8d;
      --bg-light: #f8fafc;
      --bg-white: #ffffff;
      --shadow-light: 0 2px 10px rgba(0,0,0,0.08);
      --shadow-medium: 0 4px 20px rgba(0,0,0,0.12);
      --shadow-heavy: 0 8px 30px rgba(0,0,0,0.15);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --gradient-danger: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
      --gradient-purple: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-card: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
    }

    * {
      box-sizing: border-box;
    }

    body { 
      font-family: 'Montserrat', Arial, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      margin: 0; 
      padding: 0; 
      color: var(--text-dark);
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }
    

    
    .container {
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }
    
    .dashboard-title {
      text-align: center;
      color: white;
      font-size: 3.5rem;
      font-weight: 800;
      margin-bottom: 60px;
      text-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: relative;
    }
    
    .dashboard-title::before {
      content: "üìä";
      display: block;
      font-size: 4rem;
      margin-bottom: 20px;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    /* Animations d'entr√©e */
    .stats-grid {
      animation: fadeInUp 0.8s ease-out;
    }
    
    .charts-grid {
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }
    
    .quick-actions {
      animation: fadeInUp 0.8s ease-out 0.4s both;
    }
    
    .recent-activity {
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }
    
    .period-selector {
      animation: slideInLeft 0.8s ease-out 0.1s both;
    }
    
    /* Effet de particules flottantes */
    .floating-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      animation: float 6s ease-in-out infinite;
    }
    
    .particle:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
    .particle:nth-child(2) { top: 60%; left: 80%; animation-delay: 2s; }
    .particle:nth-child(3) { top: 40%; left: 60%; animation-delay: 4s; }
    .particle:nth-child(4) { top: 80%; left: 20%; animation-delay: 1s; }
    .particle:nth-child(5) { top: 30%; left: 90%; animation-delay: 3s; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }
    
    .stat-card {
      background: var(--gradient-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px 32px;
      box-shadow: var(--shadow-medium);
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover::before {
      transform: scaleX(1);
    }
    
    .stat-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow-heavy);
    }
    
    .stat-card.active {
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow-heavy);
      border: 2px solid var(--primary-color);
    }
    
    .stat-card.revenue {
      background: linear-gradient(135deg, rgba(26, 126, 231, 0.95), rgba(15, 91, 184, 0.95));
      color: white;
      border: 1px solid rgba(26, 126, 231, 0.3);
    }
    
    .stat-card.expenses {
      background: linear-gradient(135deg, rgba(231, 76, 60, 0.95), rgba(192, 57, 43, 0.95));
      color: white;
      border: 1px solid rgba(231, 76, 60, 0.3);
    }
    
    .stat-card.profit {
      background: linear-gradient(135deg, rgba(39, 174, 96, 0.95), rgba(33, 154, 82, 0.95));
      color: white;
      border: 1px solid rgba(39, 174, 96, 0.3);
    }
    
    .stat-card.invoices {
      background: linear-gradient(135deg, rgba(142, 68, 173, 0.95), rgba(115, 45, 145, 0.95));
      color: white;
      border: 1px solid rgba(142, 68, 173, 0.3);
    }
    
    .stat-icon {
      font-size: 3.5rem;
      margin-bottom: 20px;
      display: block;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover .stat-icon {
      transform: scale(1.1) rotate(5deg);
    }
    
    .stat-value {
      font-size: 2.8rem;
      font-weight: 800;
      margin-bottom: 12px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
      letter-spacing: -0.5px;
    }
    
    .stat-label {
      font-size: 1.1rem;
      opacity: 0.95;
      font-weight: 600;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-change {
      font-size: 1rem;
      margin-top: 12px;
      opacity: 0.9;
      font-weight: 500;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      display: inline-block;
      backdrop-filter: blur(10px);
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 50px;
    }
    
    .chart-card {
      background: var(--gradient-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: var(--shadow-medium);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .chart-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-heavy);
    }
    
    .chart-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 30px;
      text-align: center;
      text-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .chart-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }
    
    .chart-container {
      position: relative;
      height: 320px;
    }
    
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }
    
    .action-card {
      background: var(--gradient-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: var(--shadow-medium);
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .action-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      transform: scale(0);
      transition: transform 0.6s ease;
    }
    
    .action-card:hover::before {
      transform: scale(1);
    }
    
    .action-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: var(--shadow-heavy);
    }
    
    .action-icon {
      font-size: 4rem;
      margin-bottom: 24px;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
      transition: transform 0.3s ease;
    }
    
    .action-card:hover .action-icon {
      transform: scale(1.1) rotate(5deg);
    }
    
    .action-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 20px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .action-description {
      color: var(--text-light);
      margin-bottom: 30px;
      line-height: 1.7;
      font-size: 1.1rem;
    }
    
    .action-button {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 16px 32px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'Montserrat', Arial, sans-serif;
      text-decoration: none;
      display: inline-block;
      box-shadow: var(--shadow-light);
      position: relative;
      overflow: hidden;
    }
    
    .action-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .action-button:hover::before {
      left: 100%;
    }
    
    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }
    
    .recent-activity {
      background: var(--gradient-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: var(--shadow-medium);
      margin-bottom: 50px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .activity-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 30px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .activity-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 80px;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    
    .activity-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(10px);
      box-shadow: var(--shadow-light);
    }
    
    .activity-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .activity-icon {
      font-size: 1.8rem;
      margin-right: 20px;
      width: 50px;
      text-align: center;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
    }
    
    .activity-content {
      flex: 1;
    }
    
    .activity-text {
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-dark);
      font-size: 1.1rem;
    }
    
    .activity-date {
      color: var(--text-light);
      font-size: 1rem;
      font-weight: 500;
    }
    
    .activity-amount {
      font-weight: 700;
      color: var(--success-color);
      font-size: 1.2rem;
      text-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
    }
    
    .activity-amount-negative {
      font-weight: 700;
      color: var(--danger-color);
      font-size: 1.2rem;
      text-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      color: #1a7ee7;
    }
    
    .period-selector {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 50px;
      background: var(--gradient-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 20px;
      box-shadow: var(--shadow-medium);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .period-button {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(26, 126, 231, 0.3);
      color: var(--text-dark);
      border-radius: 12px;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'Montserrat', Arial, sans-serif;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }
    
    .period-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .period-button:hover::before {
      left: 100%;
    }
    
    .period-button:hover, .period-button.active {
      background: var(--gradient-primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow-light);
      border-color: transparent;
    }
    
    @media (max-width: 1024px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
        margin: 20px auto;
      }
      
      .main-header {
        height: 70px;
      }
      
      .header-buttons {
        flex-direction: column;
        gap: 8px;
        margin-right: 20px;
      }
      
      .header-logo {
        margin-left: 20px;
        height: 50px;
      }
      
      .dashboard-title {
        font-size: 2.5rem;
        margin-bottom: 40px;
      }
      
      .dashboard-title::before {
        font-size: 3rem;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .stat-card {
        padding: 30px 20px;
      }
      
      .stat-value {
        font-size: 2.2rem;
      }
      
      .charts-grid {
        gap: 20px;
      }
      
      .chart-card {
        padding: 30px 20px;
      }
      
      .quick-actions {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .action-card {
        padding: 30px 20px;
      }
      
      .period-selector {
        flex-wrap: wrap;
        gap: 10px;
        padding: 15px;
      }
      
      .period-button {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
      
      .recent-activity {
        padding: 30px 20px;
      }
      
      .activity-item {
        padding: 15px;
      }
      
      .activity-icon {
        font-size: 1.5rem;
        margin-right: 15px;
        width: 40px;
      }
    }
    
    @media (max-width: 480px) {
      .dashboard-title {
        font-size: 2rem;
      }
      
      .dashboard-title::before {
        font-size: 2.5rem;
      }
      
      .stat-value {
        font-size: 1.8rem;
      }
      
      .action-icon {
        font-size: 3rem;
      }
      
      .header-button {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Particules flottantes pour l'effet de fond -->
  <div class="floating-particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>
  
  <script src="config/config.js"></script>
  
  <header class="main-header">
    <img src="assets/images/logo_capslock.png" alt="Logo CAPSLOCK" class="header-logo" onclick="window.location.href='index.html'">
    <div class="header-buttons">
              <button class="header-button" onclick="window.location.href='pages/facture.html'">Devis/Facture</button>
        <button class="header-button" onclick="window.location.href='pages/registre_achat.html'">Registre d'achat</button>
        <button class="header-button" onclick="window.location.href='pages/livre_recette.html'">Livre de recette</button>
    </div>
  </header>

  <div class="container">
    <h1 class="dashboard-title">Tableau de Bord Comptable</h1>
    
    <div class="period-selector">
      <button class="period-button active" data-period="all">Tout</button>
      <button class="period-button" data-period="year">Cette ann√©e</button>
      <button class="period-button" data-period="month">Ce mois</button>
      <button class="period-button" data-period="quarter">Ce trimestre</button>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card revenue active" id="revenueCard" onclick="switchChart('revenue')">
        <div class="stat-icon">üí∞</div>
        <div class="stat-value" id="totalRevenue">0,00 ‚Ç¨</div>
        <div class="stat-label">Chiffre d'affaires</div>
        <div class="stat-change" id="revenueChange">+0% ce mois</div>
      </div>
      
      <div class="stat-card expenses" id="expensesCard" onclick="switchChart('expenses')">
        <div class="stat-icon">üí∏</div>
        <div class="stat-value" id="totalExpenses">0,00 ‚Ç¨</div>
        <div class="stat-label">D√©penses</div>
        <div class="stat-change" id="expensesChange">+0% ce mois</div>
      </div>
      
      <div class="stat-card profit" id="profitCard" onclick="switchChart('profit')">
        <div class="stat-icon">üìà</div>
        <div class="stat-value" id="netProfit">0,00 ‚Ç¨</div>
        <div class="stat-label">B√©n√©fice net</div>
        <div class="stat-change" id="profitChange">Marge: 0%</div>
      </div>
      
      <div class="stat-card invoices" id="invoicesCard" onclick="switchChart('invoices')">
        <div class="stat-icon">üßæ</div>
        <div class="stat-value" id="totalInvoices">0</div>
        <div class="stat-label">Factures √©mises</div>
        <div class="stat-change" id="invoicesChange">Moyenne: 0,00 ‚Ç¨</div>
      </div>
    </div>
    
    <div class="charts-grid">
      <div class="chart-card">
        <h3 class="chart-title" id="chartTitle">√âvolution du chiffre d'affaires</h3>
        <div class="chart-container">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <h3 class="chart-title" id="paymentChartTitle">R√©partition des paiements</h3>
        <div class="chart-container">
          <canvas id="paymentChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="quick-actions">
      <div class="action-card">
        <div class="action-icon">üìù</div>
        <div class="action-title">Cr√©er une facture</div>
        <div class="action-description">G√©n√©rez rapidement une nouvelle facture ou un devis professionnel</div>
        <a href="facture.html" class="action-button">Cr√©er maintenant</a>
      </div>
      
      <div class="action-card">
        <div class="action-icon">üí∞</div>
        <div class="action-title">Livre de recette</div>
        <div class="action-description">Consultez et g√©rez toutes vos recettes avec des statistiques d√©taill√©es</div>
        <a href="livre_recette.html" class="action-button">Voir les recettes</a>
      </div>
      
      <div class="action-card">
        <div class="action-icon">üõí</div>
        <div class="action-title">Registre d'achat</div>
        <div class="action-description">Suivez vos d√©penses et achats professionnels avec cat√©gorisation</div>
        <a href="registre_achat.html" class="action-button">G√©rer les achats</a>
      </div>
    </div>
    
    <div class="recent-activity">
      <h3 class="activity-title">Activit√© r√©cente</h3>
      <div id="activityList">
        <div class="empty-state">
          <div class="empty-state-icon">üíº</div>
          <p>Aucune activit√© r√©cente</p>
          <p>Cr√©ez votre premi√®re facture pour commencer</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Variables globales
    let recettes = [];
    let achats = [];
    let currentPeriod = 'all';
    let currentChartType = 'revenue';
    let revenueChart = null;
    let paymentChart = null;
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      setupEventListeners();
      updateDashboard();
    });
    
    function loadData() {
      // Charger les recettes depuis localStorage
      const savedRecettes = localStorage.getItem('recettes');
      if (savedRecettes) {
        recettes = JSON.parse(savedRecettes);
      }
      
      // Charger les achats depuis localStorage
      const savedAchats = localStorage.getItem('achats');
      if (savedAchats) {
        achats = JSON.parse(savedAchats);
      }
    }
    
    function setupEventListeners() {
      // S√©lecteur de p√©riode
      document.querySelectorAll('.period-button').forEach(button => {
        button.addEventListener('click', function() {
          document.querySelectorAll('.period-button').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentPeriod = this.dataset.period;
          updateDashboard();
        });
      });
    }
    
    function updateDashboard() {
      const filteredRecettes = filterRecettesByPeriod(recettes, currentPeriod);
      const filteredAchats = filterRecettesByPeriod(achats, currentPeriod);
      updateStatistics(filteredRecettes, filteredAchats);
      updateCharts(filteredRecettes, filteredAchats);
      updateRecentActivity();
    }
    
    function switchChart(chartType) {
      // Mettre √† jour l'√©tat actif des cartes
      document.querySelectorAll('.stat-card').forEach(card => {
        card.classList.remove('active');
      });
      document.getElementById(chartType + 'Card').classList.add('active');
      
      // Mettre √† jour le type de graphique actuel
      currentChartType = chartType;
      
      // Mettre √† jour le titre du graphique principal
      const chartTitles = {
        'revenue': '√âvolution du chiffre d\'affaires',
        'expenses': '√âvolution des d√©penses',
        'profit': '√âvolution du b√©n√©fice net',
        'invoices': '√âvolution du nombre de factures'
      };
      document.getElementById('chartTitle').textContent = chartTitles[chartType];
      
      // Mettre √† jour le titre du graphique circulaire
      const paymentChartTitles = {
        'revenue': 'R√©partition des paiements',
        'expenses': 'Modes de paiement des d√©penses',
        'profit': 'R√©partition des paiements',
        'invoices': 'R√©partition des paiements'
      };
      document.getElementById('paymentChartTitle').textContent = paymentChartTitles[chartType];
      
      // Recharger les donn√©es filtr√©es et mettre √† jour le graphique
      const filteredRecettes = filterRecettesByPeriod(recettes, currentPeriod);
      const filteredAchats = filterRecettesByPeriod(achats, currentPeriod);
      updateCharts(filteredRecettes, filteredAchats);
    }
    
    function filterRecettesByPeriod(recettes, period) {
      const now = new Date();
      
      switch(period) {
        case 'month':
          return recettes.filter(r => {
            const date = new Date(r.date);
            return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
          });
        case 'quarter':
          const currentQuarter = Math.floor(now.getMonth() / 3);
          return recettes.filter(r => {
            const date = new Date(r.date);
            const quarter = Math.floor(date.getMonth() / 3);
            return quarter === currentQuarter && date.getFullYear() === now.getFullYear();
          });
        case 'year':
          return recettes.filter(r => {
            const date = new Date(r.date);
            return date.getFullYear() === now.getFullYear();
          });
        default:
          return recettes;
      }
    }
    
    function updateStatistics(filteredRecettes, filteredAchats) {
      // Calcul des statistiques
      const totalRevenue = filteredRecettes.reduce((sum, r) => sum + r.montantTTC, 0);
      const totalExpenses = filteredAchats.reduce((sum, a) => sum + a.montantTTC, 0);
      const netProfit = totalRevenue - totalExpenses;
      const totalInvoices = filteredRecettes.length;
      const averageInvoice = totalInvoices > 0 ? totalRevenue / totalInvoices : 0;
      
      // Calcul de l'√©volution mensuelle pour les recettes
      const now = new Date();
      const currentMonth = now.getMonth();
      const currentYear = now.getFullYear();
      
      const currentMonthRecettes = recettes.filter(r => {
        const date = new Date(r.date);
        return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
      });
      
      const lastMonthRecettes = recettes.filter(r => {
        const date = new Date(r.date);
        const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
        const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
        return date.getMonth() === lastMonth && date.getFullYear() === lastMonthYear;
      });
      
      const currentMonthTotal = currentMonthRecettes.reduce((sum, r) => sum + r.montantTTC, 0);
      const lastMonthTotal = lastMonthRecettes.reduce((sum, r) => sum + r.montantTTC, 0);
      
      const revenueMonthChange = lastMonthTotal > 0 ? 
        ((currentMonthTotal - lastMonthTotal) / lastMonthTotal * 100).toFixed(1) : 0;
      
      // Calcul de l'√©volution mensuelle pour les d√©penses
      const currentMonthAchats = achats.filter(a => {
        const date = new Date(a.date);
        return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
      });
      
      const lastMonthAchats = achats.filter(a => {
        const date = new Date(a.date);
        const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
        const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
        return date.getMonth() === lastMonth && date.getFullYear() === lastMonthYear;
      });
      
      const currentMonthExpenses = currentMonthAchats.reduce((sum, a) => sum + a.montantTTC, 0);
      const lastMonthExpenses = lastMonthAchats.reduce((sum, a) => sum + a.montantTTC, 0);
      
      const expensesMonthChange = lastMonthExpenses > 0 ? 
        ((currentMonthExpenses - lastMonthExpenses) / lastMonthExpenses * 100).toFixed(1) : 0;
      
      // Mise √† jour de l'affichage
      document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2) + ' ‚Ç¨';
      document.getElementById('totalExpenses').textContent = totalExpenses.toFixed(2) + ' ‚Ç¨';
      document.getElementById('netProfit').textContent = netProfit.toFixed(2) + ' ‚Ç¨';
      document.getElementById('totalInvoices').textContent = totalInvoices;
      
      // Gestion de l'affichage b√©n√©fice/d√©ficit
      const profitCard = document.querySelector('.stat-card.profit');
      const profitIcon = profitCard.querySelector('.stat-icon');
      const profitLabel = profitCard.querySelector('.stat-label');
      
      if (netProfit < 0) {
        // D√©ficit : changer l'√©moji et le label
        profitIcon.textContent = 'üìâ';
        profitLabel.textContent = 'D√©ficit net';
      } else {
        // B√©n√©fice : √©moji et label par d√©faut
        profitIcon.textContent = 'üìà';
        profitLabel.textContent = 'B√©n√©fice net';
      }
      
      // Mise √† jour des changements
      document.getElementById('revenueChange').textContent = 
        `${revenueMonthChange > 0 ? '+' : ''}${revenueMonthChange}% ce mois`;
      document.getElementById('expensesChange').textContent = 
        `${expensesMonthChange > 0 ? '+' : ''}${expensesMonthChange}% ce mois`;
      // Calcul et affichage de la marge ou du taux de d√©ficit
      const marginPercentage = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : 0;
      if (netProfit < 0) {
        document.getElementById('profitChange').textContent = 
          `D√©ficit: ${Math.abs(marginPercentage)}%`;
      } else {
        document.getElementById('profitChange').textContent = 
          `Marge: ${marginPercentage}%`;
      }
      document.getElementById('invoicesChange').textContent = 
        `Moyenne: ${averageInvoice.toFixed(2)} ‚Ç¨`;
    }
    
    function updateCharts(filteredRecettes, filteredAchats) {
      updateRevenueChart(filteredRecettes, filteredAchats);
      updatePaymentChart(filteredRecettes, filteredAchats);
    }
    
    function updateRevenueChart(filteredRecettes, filteredAchats) {
      const ctx = document.getElementById('revenueChart').getContext('2d');
      
      // Pr√©parer les donn√©es selon la p√©riode s√©lectionn√©e et le type de graphique
      let labels = [];
      let data = [];
      let chartLabel = '';
      let borderColor = '#1a7ee7';
      let backgroundColor = 'rgba(26, 126, 231, 0.1)';
      const now = new Date();
      
      // Fonction pour calculer les donn√©es selon le type de graphique
      function calculateChartData(dataSource, dataType) {
        let periodData = {};
        
        if (currentPeriod === 'month') {
          // Pour "Ce mois" : afficher les jours du mois
          const currentMonth = now.getMonth();
          const currentYear = now.getFullYear();
          const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
          
          for (let day = 1; day <= daysInMonth; day++) {
            periodData[day] = 0;
          }
          
          dataSource.forEach(item => {
            const date = new Date(item.date);
            if (date.getMonth() === currentMonth && date.getFullYear() === currentYear) {
              const day = date.getDate();
              if (dataType === 'invoices') {
                periodData[day]++;
              } else {
                periodData[day] += item.montantTTC;
              }
            }
          });
          
          labels = Object.keys(periodData).map(day => `${day} ${now.toLocaleDateString('fr-FR', { month: 'short' })}`);
          
        } else if (currentPeriod === 'quarter') {
          // Pour "Ce trimestre" : afficher les 3 mois du trimestre
          const currentQuarter = Math.floor(now.getMonth() / 3);
          const quarterStartMonth = currentQuarter * 3;
          
          for (let i = 0; i < 3; i++) {
            const month = quarterStartMonth + i;
            const date = new Date(now.getFullYear(), month, 1);
            const key = `${date.getFullYear()}-${String(month + 1).padStart(2, '0')}`;
            periodData[key] = 0;
          }
          
          dataSource.forEach(item => {
            const date = new Date(item.date);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (periodData.hasOwnProperty(key)) {
              if (dataType === 'invoices') {
                periodData[key]++;
              } else {
                periodData[key] += item.montantTTC;
              }
            }
          });
          
          labels = Object.keys(periodData).map(key => {
            const [year, month] = key.split('-');
            const date = new Date(parseInt(year), parseInt(month) - 1);
            return date.toLocaleDateString('fr-FR', { month: 'short', year: 'numeric' });
          });
          
        } else if (currentPeriod === 'year') {
          // Pour "Cette ann√©e" : afficher les 12 mois de l'ann√©e
          for (let month = 0; month < 12; month++) {
            const date = new Date(now.getFullYear(), month, 1);
            const key = `${date.getFullYear()}-${String(month + 1).padStart(2, '0')}`;
            periodData[key] = 0;
          }
          
          dataSource.forEach(item => {
            const date = new Date(item.date);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (periodData.hasOwnProperty(key)) {
              if (dataType === 'invoices') {
                periodData[key]++;
              } else {
                periodData[key] += item.montantTTC;
              }
            }
          });
          
          labels = Object.keys(periodData).map(key => {
            const [year, month] = key.split('-');
            const date = new Date(parseInt(year), parseInt(month) - 1);
            return date.toLocaleDateString('fr-FR', { month: 'short', year: 'numeric' });
          });
          
        } else {
          // Pour "Tout" : afficher les 12 derniers mois
          for (let i = 11; i >= 0; i--) {
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            periodData[key] = 0;
          }
          
          dataSource.forEach(item => {
            const date = new Date(item.date);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (periodData.hasOwnProperty(key)) {
              if (dataType === 'invoices') {
                periodData[key]++;
              } else {
                periodData[key] += item.montantTTC;
              }
            }
          });
          
          labels = Object.keys(periodData).map(key => {
            const [year, month] = key.split('-');
            const date = new Date(parseInt(year), parseInt(month) - 1);
            return date.toLocaleDateString('fr-FR', { month: 'short', year: 'numeric' });
          });
        }
        
        // Calculer le cumul pour les montants, pas pour les factures
        if (dataType === 'invoices') {
          data = Object.values(periodData);
        } else {
          let cumul = 0;
          data = Object.values(periodData).map(value => {
            cumul += value;
            return cumul;
          });
        }
      }
      
      // Calculer les donn√©es selon le type de graphique
      switch (currentChartType) {
        case 'revenue':
          calculateChartData(filteredRecettes, 'revenue');
          chartLabel = 'Chiffre d\'affaires cumul√© (‚Ç¨)';
          borderColor = '#1a7ee7';
          backgroundColor = 'rgba(26, 126, 231, 0.1)';
          break;
          
        case 'expenses':
          calculateChartData(filteredAchats, 'expenses');
          chartLabel = 'D√©penses cumul√©es (‚Ç¨)';
          borderColor = '#e74c3c';
          backgroundColor = 'rgba(231, 76, 60, 0.1)';
          break;
          
        case 'profit':
          // Pour le b√©n√©fice, on doit calculer la diff√©rence entre recettes et d√©penses
          const revenueData = {};
          const expensesData = {};
          
          // Initialiser les donn√©es pour les recettes et d√©penses
          if (currentPeriod === 'month') {
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
              revenueData[day] = 0;
              expensesData[day] = 0;
            }
            
            filteredRecettes.forEach(recette => {
              const date = new Date(recette.date);
              if (date.getMonth() === currentMonth && date.getFullYear() === currentYear) {
                const day = date.getDate();
                revenueData[day] += recette.montantTTC;
              }
            });
            
            filteredAchats.forEach(achat => {
              const date = new Date(achat.date);
              if (date.getMonth() === currentMonth && date.getFullYear() === currentYear) {
                const day = date.getDate();
                expensesData[day] += achat.montantTTC;
              }
            });
            
            labels = Object.keys(revenueData).map(day => `${day} ${now.toLocaleDateString('fr-FR', { month: 'short' })}`);
            
          } else {
            // Pour les autres p√©riodes, utiliser les mois
            const monthlyKeys = [];
            if (currentPeriod === 'quarter') {
              const currentQuarter = Math.floor(now.getMonth() / 3);
              const quarterStartMonth = currentQuarter * 3;
              for (let i = 0; i < 3; i++) {
                const month = quarterStartMonth + i;
                const date = new Date(now.getFullYear(), month, 1);
                const key = `${date.getFullYear()}-${String(month + 1).padStart(2, '0')}`;
                monthlyKeys.push(key);
                revenueData[key] = 0;
                expensesData[key] = 0;
              }
            } else if (currentPeriod === 'year') {
              for (let month = 0; month < 12; month++) {
                const date = new Date(now.getFullYear(), month, 1);
                const key = `${date.getFullYear()}-${String(month + 1).padStart(2, '0')}`;
                monthlyKeys.push(key);
                revenueData[key] = 0;
                expensesData[key] = 0;
              }
            } else {
              for (let i = 11; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyKeys.push(key);
                revenueData[key] = 0;
                expensesData[key] = 0;
              }
            }
            
            filteredRecettes.forEach(recette => {
              const date = new Date(recette.date);
              const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
              if (revenueData.hasOwnProperty(key)) {
                revenueData[key] += recette.montantTTC;
              }
            });
            
            filteredAchats.forEach(achat => {
              const date = new Date(achat.date);
              const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
              if (expensesData.hasOwnProperty(key)) {
                expensesData[key] += achat.montantTTC;
              }
            });
            
            labels = monthlyKeys.map(key => {
              const [year, month] = key.split('-');
              const date = new Date(parseInt(year), parseInt(month) - 1);
              return date.toLocaleDateString('fr-FR', { month: 'short', year: 'numeric' });
            });
          }
          
          // Calculer le b√©n√©fice cumul√©
          let cumulProfit = 0;
          const keys = Object.keys(revenueData);
          data = keys.map(key => {
            const profit = revenueData[key] - expensesData[key];
            cumulProfit += profit;
            return cumulProfit;
          });
          
          chartLabel = 'B√©n√©fice net cumul√© (‚Ç¨)';
          borderColor = '#27ae60';
          backgroundColor = 'rgba(39, 174, 96, 0.1)';
          break;
          
        case 'invoices':
          calculateChartData(filteredRecettes, 'invoices');
          chartLabel = 'Nombre de factures';
          borderColor = '#8e44ad';
          backgroundColor = 'rgba(142, 68, 173, 0.1)';
          break;
      }
      
            if (revenueChart) {
        revenueChart.destroy();
      }
      
      // Choisir le type de graphique selon le type de donn√©es
      const chartType = currentChartType === 'invoices' ? 'bar' : 'line';
      
      // Configuration sp√©cifique selon le type de graphique
      const chartConfig = {
        type: chartType,
        data: {
          labels: labels,
          datasets: [{
            label: chartLabel,
            data: data,
            borderColor: borderColor,
            backgroundColor: chartType === 'bar' ? borderColor : backgroundColor,
            borderWidth: chartType === 'bar' ? 0 : 3,
            fill: chartType === 'bar' ? false : true,
            tension: chartType === 'bar' ? 0 : 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: currentChartType !== 'profit',
              ticks: {
                callback: function(value) {
                  if (currentChartType === 'invoices') {
                    return value.toFixed(0);
                  } else {
                    return value.toFixed(0) + ' ‚Ç¨';
                  }
                }
              }
            }
          }
        }
      };
      
      revenueChart = new Chart(ctx, chartConfig);
    }
    
    function updatePaymentChart(filteredRecettes, filteredAchats) {
      const ctx = document.getElementById('paymentChart').getContext('2d');
      
      let paymentMethods = {};
      let chartTitle = '';
      let colors = ['#1a7ee7', '#27ae60', '#e74c3c', '#f39c12', '#8e44ad'];
      
      // Choisir les donn√©es selon le type de graphique actuel
      if (currentChartType === 'expenses') {
        // Pour les d√©penses, afficher les modes de paiement des achats
        filteredAchats.forEach(achat => {
          const method = achat.modePaiement || 'Non sp√©cifi√©';
          paymentMethods[method] = (paymentMethods[method] || 0) + achat.montantTTC;
        });
        chartTitle = 'Modes de paiement des d√©penses';
        colors = ['#e74c3c', '#c0392b', '#d35400', '#e67e22', '#f39c12'];
      } else {
        // Pour les autres types, afficher les modes de paiement des recettes
        filteredRecettes.forEach(recette => {
          const method = recette.modePaiement || 'Non sp√©cifi√©';
          paymentMethods[method] = (paymentMethods[method] || 0) + recette.montantTTC;
        });
        chartTitle = 'R√©partition des paiements';
      }
      
      const methodLabels = {
        'virement': 'Virement',
        'cheque': 'Ch√®que',
        'carte': 'Carte bancaire',
        'espece': 'Esp√®ce'
      };
      
      const labels = Object.keys(paymentMethods).map(key => methodLabels[key] || key);
      const data = Object.values(paymentMethods);
      
      if (paymentChart) {
        paymentChart.destroy();
      }
      
      if (data.length === 0) {
        // Afficher un message si pas de donn√©es
        ctx.fillStyle = '#666';
        ctx.font = '16px Montserrat';
        ctx.textAlign = 'center';
        ctx.fillText('Aucune donn√©e disponible', ctx.canvas.width / 2, ctx.canvas.height / 2);
        return;
      }
      
      paymentChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: colors,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
    
    function updateRecentActivity() {
      const activityList = document.getElementById('activityList');
      
      // Combiner recettes et achats
      const allActivities = [
        ...recettes.map(r => ({...r, type: 'recette'})),
        ...achats.map(a => ({...a, type: 'achat'}))
      ].sort((a, b) => new Date(b.date) - new Date(a.date))
       .slice(0, 10);
      
      if (allActivities.length === 0) {
        activityList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üíº</div>
            <p>Aucune activit√© r√©cente</p>
            <p>Cr√©ez votre premi√®re facture ou enregistrez un achat pour commencer</p>
          </div>
        `;
        return;
      }
      
      activityList.innerHTML = allActivities.map(activity => {
        const isRecette = activity.type === 'recette';
        const icon = isRecette ? 'üí∞' : 'üõí';
        const prefix = isRecette ? 'Facture' : 'Achat';
        const numero = isRecette ? activity.numeroFacture : activity.numeroFacture;
        const nom = isRecette ? activity.client : activity.fournisseur;
        const amountClass = isRecette ? 'activity-amount' : 'activity-amount-negative';
        
        return `
          <div class="activity-item">
            <div class="activity-icon">${icon}</div>
            <div class="activity-content">
              <div class="activity-text">
                ${prefix} ${numero} - ${nom}
              </div>
              <div class="activity-date">
                ${new Date(activity.date).toLocaleDateString('fr-FR')}
              </div>
            </div>
            <div class="${amountClass}">
              ${isRecette ? '+' : '-'}${activity.montantTTC.toFixed(2)} ‚Ç¨
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Rafra√Æchir les donn√©es p√©riodiquement
    setInterval(function() {
      const newRecettes = localStorage.getItem('recettes');
      const newAchats = localStorage.getItem('achats');
      
      let dataChanged = false;
      
      if (newRecettes) {
        const parsedRecettes = JSON.parse(newRecettes);
        if (JSON.stringify(parsedRecettes) !== JSON.stringify(recettes)) {
          recettes = parsedRecettes;
          dataChanged = true;
        }
      }
      
      if (newAchats) {
        const parsedAchats = JSON.parse(newAchats);
        if (JSON.stringify(parsedAchats) !== JSON.stringify(achats)) {
          achats = parsedAchats;
          dataChanged = true;
        }
      }
      
      if (dataChanged) {
        updateDashboard();
      }
    }, 5000);
  </script>
  
  <div class="footer">
    Made with ‚ù§Ô∏è by <a href="https://github.com/AllieEco" target="_blank">AllieEco</a>
  </div>
</body>
</html> 